EESchema Schematic File Version 4
EELAYER 30 0
EELAYER END
$Descr A4 11693 8268
encoding utf-8
Sheet 1 9
Title "Powerbank BMS Additional Circuitry"
Date "2021-07-11"
Rev "1"
Comp "Logic Shift"
Comment1 ""
Comment2 ""
Comment3 ""
Comment4 ""
$EndDescr
NoConn ~ 1450 1100
Text GLabel 1450 1200 2    50   Input ~ 0
BTN_NO
$Sheet
S 600  2600 650  300 
U 60EE0865
F0 "USB_FASTCHARGE_MODULE" 50
F1 "USB_FASTCHARGE_MODULE_OUTPUT.sch" 50
F2 "MODULE_VIN" O R 1250 2700 50 
F3 "MODULE_GND" O R 1250 2800 50 
$EndSheet
Wire Wire Line
	1250 2800 1300 2800
$Sheet
S 3200 1150 900  750 
U 60EE26E7
F0 "SmartSoftLatch" 50
F1 "SmartSoftLatch.sch" 50
F2 "BTN_NO" I R 4100 1600 50 
F3 "MCU_LATCH_BTN" O R 4100 1700 50 
F4 "MCU_LATCH_ENABLE" I R 4100 1800 50 
$EndSheet
Text GLabel 4250 1600 2    50   Output ~ 0
BTN_NO
Wire Wire Line
	4250 1600 4100 1600
Wire Wire Line
	1300 2700 1250 2700
$Sheet
S 3200 3650 1400 1000
U 60F78247
F0 "CHARGER_STEP_UP" 50
F1 "CHARGER_STEP_UP.sch" 50
F2 "V_BATTERY_CHARGING" O R 4600 4000 50 
$EndSheet
Text Notes 3250 4300 0    50   ~ 0
Used for charging powerbank \nfrom VDC source
$Sheet
S 3200 2200 2200 1050
U 60F2D9E7
F0 "ESP32_AND_SUCH" 50
F1 "MCU.sch" 50
F2 "BMS_TX" O R 5400 2400 50 
F3 "BMS_RX" I R 5400 2300 50 
F4 "SAFE_SHUTDOWN_SIGNAL" O L 3200 3150 50 
F5 "SOFTLATCH_GATE_ENABLE" O L 3200 2600 50 
F6 "SDA1" B R 5400 3050 50 
F7 "SCL1" O R 5400 3150 50 
F8 "SOFTLATCH_BTN_3v3" I L 3200 2750 50 
F9 "SCL2" O R 5400 2850 50 
F10 "SDA2" B R 5400 2750 50 
F11 "U1TXD" O L 3200 2950 50 
F12 "U1RXD" I L 3200 3050 50 
F13 "TOUCH_SENSE" O L 3200 2400 50 
$EndSheet
Text GLabel 3100 2600 0    50   Input ~ 0
MCU_LATCH_EN
Wire Wire Line
	3100 2600 3200 2600
Text GLabel 4250 1800 2    50   Output ~ 0
MCU_LATCH_EN
Wire Wire Line
	4250 1800 4100 1800
Text GLabel 3100 2750 0    50   Output ~ 0
MCU_LATCH_BTN
Wire Wire Line
	3100 2750 3200 2750
Wire Wire Line
	4250 1700 4100 1700
Text GLabel 4250 1700 2    50   Input ~ 0
MCU_LATCH_BTN
$Comp
L Connector:Conn_01x04_Female J4
U 1 1 60F67167
P 5800 1400
F 0 "J4" V 5738 1112 50  0000 R CNN
F 1 "BMS_UART" V 5647 1112 50  0000 R CNN
F 2 "Connector_JST:JST_XH_B4B-XH-A_1x04_P2.50mm_Vertical" H 5800 1400 50  0001 C CNN
F 3 "https://www.jst-mfg.com/product/pdf/eng/eXH.pdf" H 5800 1400 50  0001 C CNN
	1    5800 1400
	0    -1   -1   0   
$EndComp
Wire Wire Line
	5400 2300 5800 2300
Wire Wire Line
	5800 2300 5800 1600
Wire Wire Line
	5900 1600 5900 2400
Wire Wire Line
	5900 2400 5400 2400
Wire Wire Line
	5700 1600 5700 1750
NoConn ~ 6000 1600
Text Notes 6050 1750 0    50   ~ 0
VCC from BMS is 10V, dont connect\n\n
Text GLabel 850  3600 2    50   Output ~ 0
V_BATTERY_CHARGING
Text GLabel 4650 4000 2    50   Output ~ 0
V_BATTERY_CHARGING
Wire Wire Line
	4650 4000 4600 4000
$Comp
L Device:Fuse_Small F1
U 1 1 60FAD177
P 1050 3900
F 0 "F1" H 1050 4085 50  0000 C CNN
F 1 "30A" H 1050 3994 50  0000 C CNN
F 2 "Fuse:Fuseholder_Blade_Mini_Keystone_3568" H 1050 3900 50  0001 C CNN
F 3 "https://www.keyelco.com/userAssets/file/M65p42.pdf" H 1050 3900 50  0001 C CNN
	1    1050 3900
	1    0    0    -1  
$EndComp
Wire Wire Line
	1250 3900 1150 3900
$Comp
L Connector:Conn_01x02_Female J2
U 1 1 60FB0D32
P 1450 4350
F 0 "J2" H 1478 4326 50  0000 L CNN
F 1 "CHARGEPORT" H 1478 4235 50  0000 L CNN
F 2 "Connector_JST:JST_XH_B2B-XH-A_1x02_P2.50mm_Vertical" H 1450 4350 50  0001 C CNN
F 3 "https://www.jst-mfg.com/product/pdf/eng/eXH.pdf" H 1450 4350 50  0001 C CNN
	1    1450 4350
	1    0    0    1   
$EndComp
Wire Wire Line
	1150 4350 1250 4350
Wire Wire Line
	1150 4250 1250 4250
Wire Wire Line
	700  3900 950  3900
Wire Wire Line
	850  3600 700  3600
Wire Notes Line
	2000 4800 2000 3450
Wire Notes Line
	2000 3450 600  3450
Wire Notes Line
	600  3450 600  4800
Wire Notes Line
	600  4800 2000 4800
Text Notes 600  3400 0    50   ~ 10
BMS Battery in port and charging port.
Text GLabel 1500 800  2    50   Output ~ 0
LEDRING_R
Wire Wire Line
	1500 800  1450 800 
$Comp
L power:+BATT #PWR03
U 1 1 60FEDA44
P 1250 3900
F 0 "#PWR03" H 1250 3750 50  0001 C CNN
F 1 "+BATT" V 1265 4028 50  0000 L CNN
F 2 "" H 1250 3900 50  0001 C CNN
F 3 "" H 1250 3900 50  0001 C CNN
	1    1250 3900
	0    1    1    0   
$EndComp
$Comp
L power:GND #PWR01
U 1 1 60FF3549
P 1050 4400
F 0 "#PWR01" H 1050 4150 50  0001 C CNN
F 1 "GND" V 1055 4272 50  0000 R CNN
F 2 "" H 1050 4400 50  0001 C CNN
F 3 "" H 1050 4400 50  0001 C CNN
	1    1050 4400
	0    1    1    0   
$EndComp
Wire Wire Line
	1050 4400 1150 4400
Wire Wire Line
	1150 4400 1150 4350
$Comp
L power:GND #PWR05
U 1 1 6100046F
P 1300 2800
F 0 "#PWR05" H 1300 2550 50  0001 C CNN
F 1 "GND" V 1305 2672 50  0000 R CNN
F 2 "" H 1300 2800 50  0001 C CNN
F 3 "" H 1300 2800 50  0001 C CNN
	1    1300 2800
	0    -1   -1   0   
$EndComp
$Comp
L +batt_switched:+BATT_SWITCHED #PWR04
U 1 1 6100DB2C
P 1300 2700
F 0 "#PWR04" H 1300 2550 50  0001 C CNN
F 1 "+BATT_SWITCHED" V 1315 2828 50  0000 L CNN
F 2 "" H 1300 2700 50  0001 C CNN
F 3 "" H 1300 2700 50  0001 C CNN
	1    1300 2700
	0    1    1    0   
$EndComp
$Comp
L Connector:Conn_01x04_Female J?
U 1 1 61013B78
P 1050 2200
AR Path="/60ECA2F7/61013B78" Ref="J?"  Part="1" 
AR Path="/61013B78" Ref="J1"  Part="1" 
F 0 "J1" H 942 1775 50  0000 C CNN
F 1 "SCREW_TERMINALS_DCDC_MODULE" H 942 1866 50  0000 C CNN
F 2 "TB003-500-P04BE:CUI_TB003-500-P04BE" H 1050 2200 50  0001 C CNN
F 3 "https://nl.mouser.com/datasheet/2/670/tb003_500-2306959.pdf" H 1050 2200 50  0001 C CNN
	1    1050 2200
	-1   0    0    1   
$EndComp
Wire Wire Line
	1250 2000 1400 2000
Wire Wire Line
	1400 2000 1400 1950
Wire Wire Line
	1400 1950 1500 1950
Wire Wire Line
	1550 2100 1250 2100
Wire Wire Line
	1250 2200 1450 2200
Wire Wire Line
	1450 2200 1450 2250
Wire Wire Line
	1450 2250 1550 2250
Wire Wire Line
	1300 2300 1300 2400
Wire Wire Line
	1300 2400 1550 2400
Wire Wire Line
	1300 2300 1250 2300
$Comp
L power:GND #PWR?
U 1 1 61013B88
P 1550 2100
AR Path="/60ECA2F7/61013B88" Ref="#PWR?"  Part="1" 
AR Path="/61013B88" Ref="#PWR07"  Part="1" 
F 0 "#PWR07" H 1550 1850 50  0001 C CNN
F 1 "GND" V 1555 1972 50  0000 R CNN
F 2 "" H 1550 2100 50  0001 C CNN
F 3 "" H 1550 2100 50  0001 C CNN
	1    1550 2100
	0    -1   -1   0   
$EndComp
$Comp
L power:GND #PWR?
U 1 1 61013B8E
P 1550 2400
AR Path="/60ECA2F7/61013B8E" Ref="#PWR?"  Part="1" 
AR Path="/61013B8E" Ref="#PWR09"  Part="1" 
F 0 "#PWR09" H 1550 2150 50  0001 C CNN
F 1 "GND" V 1555 2272 50  0000 R CNN
F 2 "" H 1550 2400 50  0001 C CNN
F 3 "" H 1550 2400 50  0001 C CNN
	1    1550 2400
	0    -1   -1   0   
$EndComp
$Comp
L power:+5V #PWR?
U 1 1 61013B94
P 1550 2250
AR Path="/60ECA2F7/61013B94" Ref="#PWR?"  Part="1" 
AR Path="/61013B94" Ref="#PWR08"  Part="1" 
F 0 "#PWR08" H 1550 2100 50  0001 C CNN
F 1 "+5V" V 1565 2378 50  0000 L CNN
F 2 "" H 1550 2250 50  0001 C CNN
F 3 "" H 1550 2250 50  0001 C CNN
	1    1550 2250
	0    1    1    0   
$EndComp
$Comp
L +batt_switched:+BATT_SWITCHED #PWR?
U 1 1 61013B9A
P 1550 1950
AR Path="/60ECA2F7/61013B9A" Ref="#PWR?"  Part="1" 
AR Path="/61013B9A" Ref="#PWR06"  Part="1" 
F 0 "#PWR06" H 1550 1800 50  0001 C CNN
F 1 "+BATT_SWITCHED" V 1565 2078 50  0000 L CNN
F 2 "" H 1550 1950 50  0001 C CNN
F 3 "" H 1550 1950 50  0001 C CNN
	1    1550 1950
	0    1    1    0   
$EndComp
Wire Wire Line
	700  3900 700  3600
Wire Wire Line
	1500 1950 1500 2050
Wire Wire Line
	1500 2050 2100 2050
Connection ~ 1500 1950
Wire Wire Line
	1500 1950 1550 1950
$Comp
L power:PWR_FLAG #FLG02
U 1 1 6109AB15
P 2100 2050
F 0 "#FLG02" H 2100 2125 50  0001 C CNN
F 1 "PWR_FLAG" H 2100 2223 50  0000 C CNN
F 2 "" H 2100 2050 50  0001 C CNN
F 3 "~" H 2100 2050 50  0001 C CNN
	1    2100 2050
	-1   0    0    1   
$EndComp
$Comp
L power:PWR_FLAG #FLG01
U 1 1 6109B730
P 1250 4250
F 0 "#FLG01" H 1250 4325 50  0001 C CNN
F 1 "PWR_FLAG" H 1250 4423 50  0000 C CNN
F 2 "" H 1250 4250 50  0001 C CNN
F 3 "~" H 1250 4250 50  0001 C CNN
	1    1250 4250
	1    0    0    -1  
$EndComp
Connection ~ 1250 4250
$Comp
L power:GND #PWR?
U 1 1 610A7150
P 5700 1750
AR Path="/60ECA2F7/610A7150" Ref="#PWR?"  Part="1" 
AR Path="/610A7150" Ref="#PWR011"  Part="1" 
F 0 "#PWR011" H 5700 1500 50  0001 C CNN
F 1 "GND" H 5705 1577 50  0000 C CNN
F 2 "" H 5700 1750 50  0001 C CNN
F 3 "" H 5700 1750 50  0001 C CNN
	1    5700 1750
	1    0    0    -1  
$EndComp
$Comp
L power:GND #PWR?
U 1 1 610A84AF
P 6050 2500
AR Path="/60ECA2F7/610A84AF" Ref="#PWR?"  Part="1" 
AR Path="/610A84AF" Ref="#PWR012"  Part="1" 
F 0 "#PWR012" H 6050 2250 50  0001 C CNN
F 1 "GND" V 6055 2372 50  0000 R CNN
F 2 "" H 6050 2500 50  0001 C CNN
F 3 "" H 6050 2500 50  0001 C CNN
	1    6050 2500
	0    1    1    0   
$EndComp
$Comp
L Connector:Conn_01x04_Female J5
U 1 1 60F9EBFE
P 6350 2850
F 0 "J5" H 6200 2400 50  0000 R CNN
F 1 "OLED_CONN" H 6350 2550 50  0000 R CNN
F 2 "Connector_JST:JST_XH_B4B-XH-A_1x04_P2.50mm_Vertical" H 6350 2850 50  0001 C CNN
F 3 "https://www.jst-mfg.com/product/pdf/eng/eXH.pdf" H 6350 2850 50  0001 C CNN
	1    6350 2850
	1    0    0    -1  
$EndComp
Wire Wire Line
	5400 2750 6150 2750
Wire Wire Line
	5400 2850 6150 2850
$Comp
L power:+3.3V #PWR013
U 1 1 60FA2045
P 6150 2950
F 0 "#PWR013" H 6150 2800 50  0001 C CNN
F 1 "+3.3V" V 6165 3078 50  0000 L CNN
F 2 "" H 6150 2950 50  0001 C CNN
F 3 "" H 6150 2950 50  0001 C CNN
	1    6150 2950
	0    -1   -1   0   
$EndComp
$Comp
L power:GND #PWR014
U 1 1 60FA2D4B
P 6150 3050
F 0 "#PWR014" H 6150 2800 50  0001 C CNN
F 1 "GND" V 6155 2922 50  0000 R CNN
F 2 "" H 6150 3050 50  0001 C CNN
F 3 "" H 6150 3050 50  0001 C CNN
	1    6150 3050
	0    1    1    0   
$EndComp
$Sheet
S 6250 3600 1000 700 
U 60FA4163
F0 "I2C_led_controller" 50
F1 "I2CLEDCONTROL.sch" 50
F2 "LEDRING_R" O L 6250 3700 50 
F3 "LEDRING_G" O L 6250 3800 50 
F4 "LEDRING_B" O L 6250 3900 50 
F5 "SDA" B L 6250 4100 50 
F6 "SCL" I L 6250 4200 50 
$EndSheet
Wire Wire Line
	5400 3150 5600 3150
Wire Wire Line
	5600 3150 5600 4200
Wire Wire Line
	5600 4200 6250 4200
Wire Wire Line
	5400 3050 5700 3050
Wire Wire Line
	5700 3050 5700 4100
Wire Wire Line
	5700 4100 6250 4100
Text GLabel 6200 3700 0    50   Output ~ 0
LEDRING_R
Text GLabel 6200 3800 0    50   Output ~ 0
LEDRING_G
Text GLabel 6200 3900 0    50   Output ~ 0
LEDRING_B
Wire Wire Line
	6200 3700 6250 3700
Wire Wire Line
	6200 3800 6250 3800
Wire Wire Line
	6200 3900 6250 3900
Text GLabel 1500 900  2    50   Output ~ 0
LEDRING_G
Text GLabel 1500 1000 2    50   Output ~ 0
LEDRING_B
Wire Wire Line
	1450 900  1500 900 
Wire Wire Line
	1450 1000 1500 1000
$Comp
L power:+VDC #PWR02
U 1 1 60FDC35F
P 1150 4250
F 0 "#PWR02" H 1150 4150 50  0001 C CNN
F 1 "+VDC" V 1150 4479 50  0000 L CNN
F 2 "" H 1150 4250 50  0001 C CNN
F 3 "" H 1150 4250 50  0001 C CNN
	1    1150 4250
	0    -1   -1   0   
$EndComp
$Comp
L Connector:Conn_01x04_Female J3
U 1 1 60FE873B
P 2600 3150
F 0 "J3" H 2800 3050 50  0000 C CNN
F 1 "UART_COMMS_CON" H 2950 3150 50  0000 C CNN
F 2 "Connector_JST:JST_XH_B4B-XH-A_1x04_P2.50mm_Vertical" H 2600 3150 50  0001 C CNN
F 3 "~" H 2600 3150 50  0001 C CNN
	1    2600 3150
	-1   0    0    1   
$EndComp
Wire Wire Line
	2800 2950 3200 2950
Wire Wire Line
	2800 3050 3200 3050
Wire Wire Line
	2800 3150 3200 3150
$Comp
L power:GND #PWR010
U 1 1 60FED4F1
P 2900 3250
F 0 "#PWR010" H 2900 3000 50  0001 C CNN
F 1 "GND" V 2905 3122 50  0000 R CNN
F 2 "" H 2900 3250 50  0001 C CNN
F 3 "" H 2900 3250 50  0001 C CNN
	1    2900 3250
	0    -1   -1   0   
$EndComp
Wire Wire Line
	2900 3250 2800 3250
$Sheet
S 600  700  850  700 
U 60EAFEE2
F0 "MomentaryRGBSwitch" 50
F1 "MomentaryRGBSwitch.sch" 50
F2 "LED_R" I R 1450 800 50 
F3 "LED_G" I R 1450 900 50 
F4 "LED_B" I R 1450 1000 50 
F5 "BUTTON_NC" O R 1450 1100 50 
F6 "BUTTON_NO" O R 1450 1200 50 
F7 "CAPACITIVE_SENSE" O R 1450 1300 50 
$EndSheet
Text GLabel 1500 1300 2    50   Output ~ 0
CAPACITIVE_BTN_SENSE
Wire Wire Line
	1500 1300 1450 1300
Text GLabel 3150 2400 0    50   Input ~ 0
CAPACITIVE_BTN_SENSE
Wire Wire Line
	3200 2400 3150 2400
$EndSCHEMATC
